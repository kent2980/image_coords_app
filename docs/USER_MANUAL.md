# Image Coordinates App ユーザーマニュアル

## 目次

1. [はじめに](#はじめに)
2. [システム要件](#システム要件)
3. [インストール](#インストール)
4. [基本操作](#基本操作)
5. [編集モード](#編集モード)
6. [閲覧モード](#閲覧モード)
7. [設定](#設定)
8. [トラブルシューティング](#トラブルシューティング)
9. [よくある質問](#よくある質問)

## はじめに

Image Coordinates Appは、画像上に座標を配置・管理するためのアプリケーションです。製造業での品質検査や画像解析作業において、座標データの効率的な記録と管理を支援します。

### 主な機能

- 画像上への座標配置
- 座標の詳細情報管理
- 基盤セッション機能
- データの自動保存
- 編集/閲覧モード切替
- 作業者管理

## システム要件

### 動作環境

- **OS**: Windows 10/11 (64bit)
- **Python**: 3.8以上
- **メモリ**: 4GB以上推奨
- **ストレージ**: 1GB以上の空き容量
- **ディスプレイ**: 1366x768以上

### 対応画像形式

- JPEG (.jpg, .jpeg)
- PNG (.png)
- BMP (.bmp)
- GIF (.gif)
- TIFF (.tiff)

## インストール

### 1. リポジトリのクローン

```bash
git clone https://github.com/kent2980/image_coords_app.git
cd image_coords_app
```

### 2. Python仮想環境の作成

```bash
python -m venv .venv
```

### 3. 仮想環境の有効化

**Windows:**
```bash
.venv\Scripts\activate
```

**macOS/Linux:**
```bash
source .venv/bin/activate
```

### 4. 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 5. アプリケーションの起動

```bash
python main.py
```

## 基本操作

### アプリケーション起動

1. **作業者情報の入力**
   - 作業者番号と名前を入力
   - 新規作業者の場合は自動で登録される

2. **メイン画面の構成**
   - **キャンバス**: 画像表示・座標配置エリア
   - **サイドバー**: フォーム入力・情報表示エリア
   - **トップコントロール**: モード切替・設定ボタン
   - **メニューボタン**: 座標操作・基盤操作ボタン

### モード切替

#### 編集モード
- 座標の追加・削除・編集が可能
- 初期状態はこのモード

#### 閲覧モード
- 既存データの確認・検索が可能
- 座標の変更は不可

## 編集モード

### 作業開始の流れ

1. **モデル選択**
   - トップコントロールのモデルコンボボックスから選択
   - 選択したモデルの画像が自動で読み込まれる

2. **ロット番号入力**
   - 「指図」フィールドにロット番号を入力
   - 形式: `1234567-10` または `1234567-20`
   - Enterキーで確定

### 座標の追加

1. **基本手順**
   - キャンバス上で**左クリック**
   - 座標が自動で追加される
   - サイドバーに詳細情報を入力

2. **詳細情報の入力**
   - **リファレンス**: 座標の参照情報
   - **不良項目**: プルダウンから選択
   - **コメント**: 追加情報を記入

### 座標の選択・編集

1. **座標の選択**
   - キャンバス上で**右クリック**
   - 最も近い座標が選択される

2. **座標の削除**
   - 座標を選択後、「削除」ボタンをクリック
   - または**Deleteキー**を押下

3. **座標間の移動**
   - 「前へ」「次へ」ボタンで座標間を移動
   - または矢印キー

### データの保存

1. **自動保存**
   - 詳細情報を入力すると自動で保存される
   - JSONファイルとして保存

2. **手動保存**
   - メニューから「ファイル」→「保存」
   - または`Ctrl+S`

### 基盤操作

1. **次の基盤へ移動**
   - 「次へ」ボタンをクリック
   - 現在の基盤データが自動保存される

2. **前の基盤へ移動**
   - 「前へ」ボタンをクリック
   - 保存済みデータが読み込まれる

3. **基盤の削除**
   - 「基盤削除」ボタンをクリック
   - 確認ダイアログで「はい」を選択

## 閲覧モード

### データの読み込み

1. **JSONファイルから読み込み**
   - メニューから「ファイル」→「開く」
   - 対象のJSONファイルを選択

2. **ロット番号による読み込み**
   - 「指図」フィールドにロット番号を入力
   - Enterキーで開始JSONファイルを自動読み込み

3. **現品票切り替え**
   - 「現品票で切り替え」ボタンをクリック
   - ダイアログでロット番号を入力

### データの確認

1. **座標の確認**
   - キャンバス上の座標をクリック
   - サイドバーに詳細情報が表示

2. **座標間の移動**
   - 「前へ」「次へ」ボタンで移動
   - 選択中の座標がハイライト表示

3. **座標の検索**
   - サイドバーの検索機能を使用
   - リファレンスや不良項目で絞り込み

## 設定

### 基本設定

1. **設定画面の起動**
   - トップコントロールの「⚙ 設定」ボタンをクリック

2. **ディレクトリ設定**
   - **画像ディレクトリ**: モデル画像の保存場所
   - **データディレクトリ**: JSONファイルの保存場所

3. **デフォルトモード**
   - 起動時のモードを選択
   - 編集モード/閲覧モード

### 不良項目のカスタマイズ

1. **defects.txtファイルの編集**
   ```text
   ズレ
   裏
   飛び
   傷
   汚れ
   欠け
   変色
   寸法不良
   形状不良
   その他
   ```

2. **ファイルの配置**
   - アプリケーションのルートディレクトリに配置
   - UTF-8エンコーディングで保存

## トラブルシューティング

### よくある問題と解決方法

#### 1. 画像が表示されない

**症状**: モデルを選択しても画像が表示されない

**原因と解決方法**:
- **画像ファイルが存在しない**
  - 画像ディレクトリの設定を確認
  - ファイルパスに日本語が含まれていないか確認
- **対応していない画像形式**
  - JPEG, PNG, BMP, GIF, TIFFに変換
- **ファイル権限の問題**
  - 画像ファイルの読み取り権限を確認

#### 2. 座標が保存されない

**症状**: 座標を追加しても保存されない

**原因と解決方法**:
- **ロット番号が未入力**
  - 「指図」フィールドにロット番号を入力
- **データディレクトリの権限不足**
  - 書き込み権限のあるディレクトリに変更
- **ディスク容量不足**
  - 十分な空き容量を確保

#### 3. 作業者情報が読み込まれない

**症状**: 起動時に作業者選択ダイアログが表示されない

**原因と解決方法**:
- **worker.csvファイルの破損**
  - ファイルを削除して再起動（新規作成される）
- **エンコーディングの問題**
  - UTF-8で保存し直す

#### 4. アプリケーションが起動しない

**症状**: main.pyを実行してもアプリケーションが起動しない

**原因と解決方法**:
- **Pythonバージョンの不適合**
  - Python 3.8以上をインストール
- **依存関係の不足**
  - `pip install -r requirements.txt`を実行
- **仮想環境の問題**
  - 仮想環境を削除して再作成

### エラーメッセージ別対処法

#### "JSONファイル読み込みエラー"

```
原因: ファイルの文字化けまたは形式エラー
対処: ファイルをUTF-8で保存し直す
```

#### "画像読み込みエラー"

```
原因: 対応していない画像形式または破損ファイル
対処: 対応形式に変換するか、別の画像を使用
```

#### "権限エラー"

```
原因: ファイル・ディレクトリの書き込み権限不足
対処: 管理者権限で実行するか、権限設定を変更
```

### デバッグモード

**開発者向けデバッグ情報の表示**:

```bash
# 環境変数でデバッグモードを有効化
set DEBUG=1
python main.py
```

または

```python
# コード内での有効化
main_controller.set_debug_mode(True)
```

## よくある質問

### Q1: 複数の作業者で同時に使用できますか？

**A**: 現在のバージョンでは、同一ファイルに対する同時編集は推奨されません。ネットワーク共有フォルダを使用する場合は、作業者間での調整が必要です。

### Q2: 大きな画像ファイルを使用できますか？

**A**: 使用可能ですが、メモリ使用量が増加します。推奨サイズは5MB以下です。大きなファイルの場合は、事前にリサイズすることを推奨します。

### Q3: データのバックアップはどのように行えばよいですか？

**A**: データディレクトリ全体を定期的にバックアップしてください。JSONファイルとlot_number_info.jsonが重要なデータです。

### Q4: モデル画像を追加するには？

**A**: 
1. 設定で指定した画像ディレクトリに画像ファイルを配置
2. ファイル名は「製品番号_説明.拡張子」の形式
3. アプリケーションを再起動してモデル選択肢を更新

### Q5: 座標データをExcelで分析したい

**A**: JSONファイルはテキスト形式なので、以下の方法で変換できます：
- オンラインJSON-CSV変換ツールを使用
- Pythonスクリプトで変換
- 専用の変換機能の実装を検討中

### Q6: ネットワークドライブでの使用は可能ですか？

**A**: 可能ですが、以下の点にご注意ください：
- ネットワーク遅延による動作速度の低下
- 権限設定の確認
- ファイルロックメカニズムの制限

### Q7: カスタム不良項目を追加したい

**A**: アプリケーションルートディレクトリの`defects.txt`ファイルを編集してください。1行につき1項目で記述し、UTF-8エンコーディングで保存してください。

### Q8: 古いデータファイルの管理方法は？

**A**: 
- 日付別にフォルダが作成されるため、古い日付のフォルダを圧縮・アーカイブ
- 重要なデータは定期的に外部ストレージにバックアップ
- 自動削除機能は今後実装予定

---

## サポート情報

### 問い合わせ先

- **技術的な問題**: GitHub Issues
- **機能要望**: GitHub Discussions
- **緊急時**: システム管理者まで

### アップデート情報

最新のアップデート情報やリリースノートは、GitHubリポジトリで確認してください。

### トレーニング資料

- [操作デモ動画](未実装)
- [サンプルデータ](../sample_data/)
- [設定ガイド](./SETUP_GUIDE.md)

---

**最終更新**: 2025年8月18日  
**バージョン**: 1.0.0  
**作成者**: GitHub Copilot
