# **ファイル管理機能設計書（社内製造ライン向け）**

## **1. フォルダ構造**

```
ルートディレクトリ（変更可能）
 └─ 日付/
     └─ モデル名/
         └─ ロット番号/
             ├─ LOTxxxxxx_001.json
             ├─ LOTxxxxxx_002.json
             └─ history/
                 ├─ LOTxxxxxx_001_20250816T1430.json
                 └─ LOTxxxxxx_002_20250816T1445.json
```

* 日付/モデル名/ロット番号で整理
* ロット番号により不良ファイルを順番確認可能
* history フォルダで履歴保存、削除日時を付加

## **2. ファイル命名規則**

```
<ロット番号>_<識別番号>.json
例: LOT20250816_001.json
```

* ロットごとに識別番号を 1 から連番で付与
* 上書き更新あり
* 修理担当者はバーコードでロット番号入力 → 1番から順に確認

## **3. 履歴管理**

* 削除は不可、履歴フォルダに退避
* 履歴は削除日時を付加してリネーム
* 復元は最新バージョンのみ
* ファイル整合性チェック実施
* 他ユーザーの同時アクセス時はロック

## **4. 操作権限**

* 削除・履歴退避・復元は **検査担当者のみ**
* 操作ログに操作担当者名を記録
* 権限チェックはアプリ起動時に一括実施

## **5. 操作ログ**

* CSV形式で保存
* 記録内容例：

```
timestamp,user,action,file_path
2025-08-16T14:30:00,検査担当者,delete,日付/モデル名/ロット番号/LOT20250816_001.json
2025-08-16T14:35:00,検査担当者,restore,日付/モデル名/ロット番号/LOT20250816_001.json
```

* 保存期間：1年
* 自動削除：アプリ起動時

## **6. バックアップ**

* 履歴フォルダ内サブフォルダに保存
* タイムスタンプは付与せず元ファイル名のまま
* 自動削除対象、アプリ起動時に整理

## **7. 検索機能**

* **対象：****ファイル名のみ**
* 並び順：作成日時順
* 件数制限あり（例：100件ずつ）
* 大文字小文字区別なし
* 部分一致検索
* 単一ファイルのみ操作可能
* プログレス表示なし
* 非表示フォルダ・特定拡張子は除外

## **8. 操作フロー図（概要）**

```
flowchart TD
    A[アプリ起動] --> B[権限チェック]
    B --> C[自動削除（履歴・バックアップ）]
    C --> D[検索・一覧表示]
    D --> E[ファイル選択（単一）]
    E --> F{操作選択}
    F --> |開く| G[JSON表示]
    F --> |履歴退避| H[履歴フォルダに移動 + 整合性チェック]
    F --> |復元| I[最新履歴をcurrentフォルダに復元]
    H --> J[操作ログに記録]
    I --> J
```

---

この設計により、検査担当者・修理担当者が安全かつ効率的に不良ファイルを管理・確認できる運用が可能になります。
